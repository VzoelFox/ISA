# Morph Architecture & Bootstrapping

## Overview
Morph is a self-hosting capable system programming environment based on a custom x86-64 assembly dialect. The goal is to build a complete toolchain (Assembler, Linker, Loader, Compiler) starting from a minimal seed.

## Components

### 1. Brainlib (ISA Layer)
Located in `brainlib/`, this directory contains the instruction set definitions in `.vzoel` format.
-   **Philosophy**: Pure ISA definitions. No OS-specific ABI details.
-   **Format**: Key-value pairs (e.g., `mov.r64.imm32 opcode=0xC7 modrm=0`).
-   **Files**: `aritmatika.vzoel`, `data.vzoel`, `kontrol.vzoel`, etc.

### 2. Tools
-   **morph-asm.py**: The current bootstrap assembler written in Python.
    -   Reads `.vzoel` definitions dynamically.
    -   Supports `format ELF64` for generating Linux executables.
    -   Supports full x86-64 addressing modes (ModRM, SIB, RIP-relative).
    -   Supports FASM-like syntax (`db`, labels, `segment`).
-   **asm.fox**: (WIP) The native assembler written in Morph assembly. Intended to replace `morph-asm.py`.

### 3. Loader
-   **fox-loader-v2**: A custom ELF64 loader written in Morph assembly (`loader/loader.fox`).
    -   **Function**: Loads `.morph` raw binaries or acts as a runtime for future features.
    -   **Self-Hosting Status**: It is compiled by `morph-asm.py` and runs successfully on Linux.

## Binary Formats

### .morph (Raw Binary)
A flat binary format containing machine code and a header.
-   **Header (16 bytes)**:
    -   Magic: `VZOELFOX` (8 bytes).
    -   Reserved/Platform ID: 8 bytes.
-   **Payload**: Raw x86-64 machine code starting at offset 16.

### ELF64
Standard Linux executable format generated by `morph-asm.py` when `format ELF64 executable` is used.

## Bootstrapping Process

1.  **Stage 0**: Python Assembler (`morph-asm.py`).
2.  **Stage 1**: Compile Loader (`loader.fox`) using Stage 0 -> `fox-loader-v2`.
3.  **Stage 2**: Compile Native Assembler (`asm.fox`) using Stage 0 -> `morph-asm`.
4.  **Stage 3**: `morph-asm` compiles itself. (Target Goal).

## Current Status
-   [x] ISA Definitions Refined (SIB, Imm optimizations).
-   [x] Python Assembler with ELF & SIB support.
-   [x] Self-Hosted Loader (`fox-loader-v2`).
-   [ ] Native Assembler (`asm.fox`) - Skeleton implemented.
